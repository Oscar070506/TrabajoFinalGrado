<div class="leaderboard-container">

  <!-- Filtros de categoría -->
  @if (categories.length > 1) {
    <app-category-filters
      [categories]="categories"
      [activeCategoryId]="activeCategoryId"
      (categorySelected)="onCategorySelected($event)">
    </app-category-filters>
  }

  @if (loading) {
    <div class="loading">Cargando leaderboard…</div>
  }

  @if (error) {
    <div class="error">{{ error }}</div>
  }

  @if (!loading && !error) {

    <h2 class="title">Leaderboard</h2>

    @if (leaderboard.length === 0) {
      <p class="empty">
        {{ categories.length === 0 ? 'Este juego no tiene categorías disponibles.' : 'No hay registros disponibles para esta categoría.' }}
      </p>
    }

    @if (leaderboard.length > 0) {
      <table class="leaderboard-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Jugador</th>
            <th>Tiempo</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody>
          @for (run of paginated; track $index; let i = $index) {
            <tr
              [class.gold]="currentPage === 0 && i === 0"
              [class.silver]="currentPage === 0 && i === 1"
              [class.bronze]="currentPage === 0 && i === 2"
              [class.clickable]="run?.videos?.links?.[0]?.uri"
              (click)="openVideo(run); $event.stopPropagation()">
              <td class="rank-cell">
                @if (getTrophy(currentPage * pageSize + i); as trophy) {
                  <img [src]="trophy" [alt]="'Puesto ' + (currentPage * pageSize + i + 1)" class="trophy-icon" />
                } @else {
                  {{ currentPage * pageSize + i + 1 }}
                }
              </td>
              <td>{{ getPlayerName(run) }}</td>
              <td>{{ getTime(run) }}</td>
              <td>{{ run?.date || '—' }}</td>
            </tr>
          }
        </tbody>
      </table>

      @if (leaderboard.length > pageSize) {
        <div class="pagination">
          <button class="page-btn" (click)="prevPage()" [disabled]="currentPage === 0">&#8249;</button>
          <span class="page-info">{{ currentPage + 1 }} / {{ Math.ceil(leaderboard.length / pageSize) }}</span>
          <button class="page-btn" (click)="nextPage()" [disabled]="(currentPage + 1) * pageSize >= leaderboard.length">&#8250;</button>
        </div>
      }
    }

  }

</div>